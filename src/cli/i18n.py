"""Sistema de internacionalizacion para DeepSeek-Code CLI."""

LANGUAGES = {
    "en": "English",
    "es": "Espanol",
    "ja": "日本語",
}

DEFAULT_LANG = "en"

# Idioma activo (se establece al inicio desde config)
_current_lang = DEFAULT_LANG


def set_language(lang: str):
    global _current_lang
    if lang in LANGUAGES:
        _current_lang = lang


def get_language() -> str:
    return _current_lang


def t(key: str, **kwargs) -> str:
    """Traduce una clave. Fallback a ingles si no existe."""
    text = _STRINGS.get(_current_lang, {}).get(key)
    if text is None:
        text = _STRINGS["en"].get(key, key)
    if kwargs:
        text = text.format(**kwargs)
    return text


_STRINGS = {
    "en": {
        # --- ui_theme.py ---
        "login_needed": "No session configured. Connect your account to get started.",
        "mode": "Mode",
        "context": "Context",
        "tools": "Tools",
        "access": "Access",
        "access_full": "full",
        "access_restricted": "restricted",
        "commands_available": "Available commands:",
        "cmd_agent": "Autonomous multi-step agent",
        "cmd_skill": "Run specialized skill",
        "cmd_skills": "List available skills",
        "cmd_serena": "Symbolic code navigation",
        "cmd_login": "Hot re-login (no restart)",
        "cmd_health": "Session health check",
        "cmd_account": "Multi-account management",
        "cmd_keys": "API key management help",
        "cmd_test": "Quick web session test",
        "cmd_logout": "Sign out and switch account",
        "cmd_exit": "Exit",
        "cmd_lang": "Change language",
        # --- onboarding.py ---
        "how_connect": "How do you want to connect?",
        "option_api": "API key",
        "option_api_desc": "(paid, platform.deepseek.com)",
        "option_web": "Web account",
        "option_web_desc": "(free, login with your account)",
        "option_cancel": "Cancel",
        "option_prompt": "Option",
        "step_label": "Step {step}/{total}: {label}",
        "setup_cancelled": "Setup cancelled.",
        "api_config": "API key configuration",
        "api_get_key": "Get your key at:",
        "api_prompt": "API key",
        "api_invalid": "Invalid API key (too short).",
        "api_validating": "Validating API key...",
        "api_failed": "API key is invalid or could not connect.",
        "retry_question": "Try again?",
        "api_validated": "API key validated",
        "config_saved": "Configuration saved.",
        "web_config": "Web account configuration",
        "checking_deps": "Checking dependencies...",
        "pyqt_missing": "PyQt5 is not installed.",
        "pyqt_install": "Run: pip install PyQt5 PyQtWebEngine",
        "pyqt_available": "PyQt5 available",
        "preparing_components": "Preparing components...",
        "wasm_failed": "Could not obtain the required WASM component.",
        "check_internet": "Check your internet connection and try again.",
        "wasm_ready": "WASM ready",
        "opening_login": "Opening login window...",
        "instructions_title": "Instructions",
        "instr_1": "1. Log in with your account",
        "instr_2": "2. Send any message in the chat",
        "instr_3": "3. The window will close automatically",
        "instr_tip": "Tip: If you're already logged in, just send a message.",
        "validating_session": "Validating session",
        "pow_valid": "PoW valid, session active",
        "session_configured": "Web session configured and validated!",
        "pow_failed": "PoW failed",
        "creds_captured_but": "Credentials captured but validation failed: {error}",
        "only_cookies": "Only cookies captured. You need to send a message in the chat.",
        "no_creds": "No credentials captured (timeout or window closed).",
        "downloading_wasm": "Downloading WASM...",
        "account_name_prompt": "Name for this account",
        "account_saved": "Account saved as '{name}'",
        # --- main.py ---
        "downloading_wasm_needed": "Downloading required WASM...",
        "wasm_downloaded": "WASM downloaded.",
        "mode_web_active": "Web mode activated",
        "mode_api_active": "API key mode activated",
        "no_credentials": "No credentials found. Run the onboarding first.",
        "starting_serena": "Starting Serena...",
        "goodbye": "Goodbye!",
        "usage_agent": "Usage: /agent <goal>",
        "usage_skill": "Usage: /skill <name> [args]",
        "thinking": "Thinking...",
        "mode_web_label": "Web (chat.deepseek.com)",
        "mode_api_label": "API key",
        # --- commands.py ---
        "serena_not_init": "Serena is not initialized.",
        "serena_use_start": "Serena is not initialized. Use /serena start",
        "restarting_serena": "Restarting Serena...",
        "serena_status_active": "active",
        "serena_status_stopped": "stopped",
        "serena_tools": "Tools: {count}",
        "serena_project": "Project: {path}",
        "agent_panel_title": "Autonomous Agent",
        "agent_meta": "Goal: {goal}",
        "agent_step": "Step {n}: {preview}",
        "agent_no_summary": "No summary",
        "agent_result": "Result: {status}",
        "agent_stats": "{steps} steps, {time:.1f}s",
        "agent_log": "Log saved to: {path}",
        "agent_interrupt": "Interrupting agent...",
        "agent_error": "Agent error: {error}",
        "skill_usage": "Usage: /skill <name> [arguments]",
        "skill_not_found": "Skill '{name}' not found in {dir}",
        "skill_ok": "OK",
        "skill_fail": "FAIL",
        "skill_error": "Error running skill: {error}",
        "knowledge_skill_hint": "This skill contains documentation. Use:",
        "knowledge_consulting": "Consulting with {name} context...",
        "knowledge_error": "Error consulting skill: {error}",
        "login_pyqt_missing": "Error: PyQt5 not installed. Run: pip install PyQt5 PyQtWebEngine",
        "login_opening": "Opening login window...",
        "login_validated": "Web session configured and validated.",
        "login_renewed": "Session renewed. Ready to use.",
        "login_restart": "Restart the app to use the new session.",
        "login_creds_but": "Credentials captured but validation failed: {error}",
        "login_only_cookies": "Only cookies captured. Missing bearer token.",
        "login_no_creds": "No credentials captured (timeout or window closed).",
        "test_missing": "Missing web credentials. Use /login first.",
        "test_validating": "Validating session...",
        "test_valid": "Web session valid.",
        "test_invalid": "Session invalid. Use /login to renew.",
        "health_unavailable": "SessionManager not available.",
        "health_running": "Running health check...",
        "health_mode_web": "web (chat.deepseek.com)",
        "health_mode_api": "API key (platform.deepseek.com)",
        "health_mode_none": "no credentials",
        "health_ok": "OK",
        "health_fail": "FAIL",
        "health_not_checked": "Not verified",
        "health_last_check": "Last check: {time}s ago",
        "health_last_never": "Last check: never",
        "health_failures": "Consecutive failures: {n}",
        "health_bearer": "Bearer: {status}",
        "health_cookies": "Cookies: {status}",
        "health_apikey": "API key: {status}",
        "yes": "yes",
        "no": "no",
        "no_skills": "No skills in {dir}",
        "add_skills_hint": "Add .yaml (workflows) or .skill (knowledge) files to that folder.",
        "skills_panel": "Available skills ({count})",
        "knowledge_tag": "knowledge, {size}KB",
        "workflow_tag": "workflow",
        "account_none": "No saved accounts.",
        "account_use_add": "  Use /account add to save the current account.",
        "account_active": "Active account: {name}",
        "account_switch_usage": "Usage: /account switch <name>",
        "account_not_found": "Account '{name}' not found.",
        "account_switched": "Switched to account '{name}' ({mode})",
        "account_name_default": "default",
        "account_added": "Account '{name}' saved.",
        "account_remove_usage": "Usage: /account remove <name>",
        "account_removed": "Account '{name}' removed.",
        "lang_select": "Select your language:",
        "lang_changed": "Language changed to {lang}.",
        "lang_current": "Current language: {lang}",
        "logout_no_session": "No active session to sign out from.",
        "logout_current": "Active session: {mode}",
        "logout_confirm": "Sign out and clear credentials?",
        "logout_cancelled": "Cancelled.",
        "logout_done": "Session closed. Credentials cleared.",
        "logout_relogin": "Log in with another account now?",
    },
    "es": {
        "login_needed": "No hay sesion configurada. Conecta tu cuenta para empezar.",
        "mode": "Modo",
        "context": "Contexto",
        "tools": "Herramientas",
        "access": "Acceso",
        "access_full": "completo",
        "access_restricted": "restringido",
        "commands_available": "Comandos disponibles:",
        "cmd_agent": "Agente autonomo multi-paso",
        "cmd_skill": "Ejecutar skill especializada",
        "cmd_skills": "Listar skills disponibles",
        "cmd_serena": "Navegacion simbolica de codigo",
        "cmd_login": "Re-login en caliente (sin reiniciar)",
        "cmd_health": "Health check de la sesion",
        "cmd_account": "Gestion de cuentas multiples",
        "cmd_keys": "Ayuda sobre gestion de API keys",
        "cmd_test": "Test rapido de la sesion web",
        "cmd_logout": "Cerrar sesion y cambiar cuenta",
        "cmd_exit": "Salir",
        "cmd_lang": "Cambiar idioma",
        "how_connect": "Como quieres conectar?",
        "option_api": "API key",
        "option_api_desc": "(de pago, platform.deepseek.com)",
        "option_web": "Cuenta web",
        "option_web_desc": "(gratis, login con tu cuenta)",
        "option_cancel": "Cancelar",
        "option_prompt": "Opcion",
        "step_label": "Paso {step}/{total}: {label}",
        "setup_cancelled": "Configuracion cancelada.",
        "api_config": "Configuracion con API key",
        "api_get_key": "Obtiene tu key en:",
        "api_prompt": "API key",
        "api_invalid": "API key invalida (muy corta).",
        "api_validating": "Validando API key...",
        "api_failed": "La API key no es valida o no se pudo conectar.",
        "retry_question": "Intentar de nuevo?",
        "api_validated": "API key validada",
        "config_saved": "Configuracion guardada.",
        "web_config": "Configuracion con cuenta web",
        "checking_deps": "Verificando dependencias...",
        "pyqt_missing": "PyQt5 no esta instalado.",
        "pyqt_install": "Ejecuta: pip install PyQt5 PyQtWebEngine",
        "pyqt_available": "PyQt5 disponible",
        "preparing_components": "Preparando componentes...",
        "wasm_failed": "No se pudo obtener el componente WASM necesario.",
        "check_internet": "Verifica tu conexion a internet e intenta de nuevo.",
        "wasm_ready": "WASM listo",
        "opening_login": "Abriendo ventana de login...",
        "instructions_title": "Instrucciones",
        "instr_1": "1. Inicia sesion con tu cuenta",
        "instr_2": "2. Envia cualquier mensaje en el chat",
        "instr_3": "3. La ventana se cerrara automaticamente",
        "instr_tip": "Tip: Si ya tienes sesion iniciada, solo envia un mensaje.",
        "validating_session": "Validando sesion",
        "pow_valid": "PoW valido, sesion activa",
        "session_configured": "Sesion web configurada y validada!",
        "pow_failed": "PoW fallo",
        "creds_captured_but": "Credenciales capturadas pero validacion fallo: {error}",
        "only_cookies": "Solo cookies capturadas. Falta enviar un mensaje en el chat.",
        "no_creds": "No se capturaron credenciales (timeout o ventana cerrada).",
        "downloading_wasm": "Descargando WASM...",
        "account_name_prompt": "Nombre para esta cuenta",
        "account_saved": "Cuenta guardada como '{name}'",
        "downloading_wasm_needed": "Descargando WASM necesario...",
        "wasm_downloaded": "WASM descargado.",
        "mode_web_active": "Modo web activado",
        "mode_api_active": "Modo API key activado",
        "no_credentials": "No se encontraron credenciales. Ejecuta el onboarding primero.",
        "starting_serena": "Iniciando Serena...",
        "goodbye": "Hasta luego!",
        "usage_agent": "Uso: /agent <meta>",
        "usage_skill": "Uso: /skill <nombre> [args]",
        "thinking": "Pensando...",
        "mode_web_label": "Web (chat.deepseek.com)",
        "mode_api_label": "API key",
        "serena_not_init": "Serena no esta inicializada.",
        "serena_use_start": "Serena no esta inicializada. Usa /serena start",
        "restarting_serena": "Reiniciando Serena...",
        "serena_status_active": "activa",
        "serena_status_stopped": "detenida",
        "serena_tools": "Herramientas: {count}",
        "serena_project": "Proyecto: {path}",
        "agent_panel_title": "Agente Autonomo",
        "agent_meta": "Meta: {goal}",
        "agent_step": "Paso {n}: {preview}",
        "agent_no_summary": "Sin resumen",
        "agent_result": "Resultado: {status}",
        "agent_stats": "{steps} pasos, {time:.1f}s",
        "agent_log": "Log guardado en: {path}",
        "agent_interrupt": "Interrumpiendo agente...",
        "agent_error": "Error del agente: {error}",
        "skill_usage": "Uso: /skill <nombre> [argumentos]",
        "skill_not_found": "Skill '{name}' no encontrado en {dir}",
        "skill_ok": "OK",
        "skill_fail": "FALLO",
        "skill_error": "Error ejecutando skill: {error}",
        "knowledge_skill_hint": "Este skill contiene documentacion. Usa:",
        "knowledge_consulting": "Consultando con contexto de {name}...",
        "knowledge_error": "Error consultando skill: {error}",
        "login_pyqt_missing": "Error: PyQt5 no instalado. Ejecuta: pip install PyQt5 PyQtWebEngine",
        "login_opening": "Abriendo ventana de login...",
        "login_validated": "Sesion web configurada y validada.",
        "login_renewed": "Sesion renovada. Lista para usar.",
        "login_restart": "Reinicia la app para usar la nueva sesion.",
        "login_creds_but": "Credenciales capturadas pero validacion fallo: {error}",
        "login_only_cookies": "Solo cookies capturadas. Falta bearer token.",
        "login_no_creds": "No se capturaron credenciales (timeout o ventana cerrada).",
        "test_missing": "Faltan credenciales web. Usa /login primero.",
        "test_validating": "Validando sesion...",
        "test_valid": "Sesion web valida.",
        "test_invalid": "Sesion invalida. Usa /login para renovar.",
        "health_unavailable": "SessionManager no disponible.",
        "health_running": "Ejecutando health check...",
        "health_mode_web": "web (chat.deepseek.com)",
        "health_mode_api": "API key (platform.deepseek.com)",
        "health_mode_none": "sin credenciales",
        "health_ok": "OK",
        "health_fail": "FALLO",
        "health_not_checked": "No verificado",
        "health_last_check": "Ultimo check: hace {time}s",
        "health_last_never": "Ultimo check: nunca",
        "health_failures": "Failures consecutivos: {n}",
        "health_bearer": "Bearer: {status}",
        "health_cookies": "Cookies: {status}",
        "health_apikey": "API key: {status}",
        "yes": "si",
        "no": "no",
        "no_skills": "No hay skills en {dir}",
        "add_skills_hint": "Agrega archivos .yaml (workflows) o .skill (conocimiento) a esa carpeta.",
        "skills_panel": "Skills disponibles ({count})",
        "knowledge_tag": "conocimiento, {size}KB",
        "workflow_tag": "workflow",
        "account_none": "No hay cuentas guardadas.",
        "account_use_add": "  Usa /account add para guardar la cuenta actual.",
        "account_active": "Cuenta activa: {name}",
        "account_switch_usage": "Uso: /account switch <nombre>",
        "account_not_found": "Cuenta '{name}' no encontrada.",
        "account_switched": "Cambiado a cuenta '{name}' ({mode})",
        "account_name_default": "default",
        "account_added": "Cuenta '{name}' guardada.",
        "account_remove_usage": "Uso: /account remove <nombre>",
        "account_removed": "Cuenta '{name}' eliminada.",
        "lang_select": "Selecciona tu idioma:",
        "lang_changed": "Idioma cambiado a {lang}.",
        "lang_current": "Idioma actual: {lang}",
        "logout_no_session": "No hay sesion activa para cerrar.",
        "logout_current": "Sesion activa: {mode}",
        "logout_confirm": "Cerrar sesion y limpiar credenciales?",
        "logout_cancelled": "Cancelado.",
        "logout_done": "Sesion cerrada. Credenciales limpiadas.",
        "logout_relogin": "Iniciar sesion con otra cuenta ahora?",
    },
    "ja": {
        "login_needed": "セッションが設定されていません。アカウントを接続してください。",
        "mode": "モード",
        "context": "コンテキスト",
        "tools": "ツール",
        "access": "アクセス",
        "access_full": "フル",
        "access_restricted": "制限あり",
        "commands_available": "利用可能なコマンド:",
        "cmd_agent": "自律マルチステップエージェント",
        "cmd_skill": "専門スキルを実行",
        "cmd_skills": "利用可能なスキル一覧",
        "cmd_serena": "シンボリックコードナビゲーション",
        "cmd_login": "ホットリログイン（再起動不要）",
        "cmd_health": "セッションヘルスチェック",
        "cmd_account": "マルチアカウント管理",
        "cmd_keys": "APIキー管理ヘルプ",
        "cmd_test": "Webセッション簡易テスト",
        "cmd_exit": "終了",
        "cmd_logout": "ログアウトしてアカウント切替",
        "cmd_lang": "言語を変更",
        "how_connect": "接続方法を選択してください:",
        "option_api": "APIキー",
        "option_api_desc": "（有料、platform.deepseek.com）",
        "option_web": "Webアカウント",
        "option_web_desc": "（無料、アカウントでログイン）",
        "option_cancel": "キャンセル",
        "option_prompt": "オプション",
        "setup_cancelled": "設定がキャンセルされました。",
        "thinking": "考え中...",
        "goodbye": "さようなら！",
        "starting_serena": "Serenaを起動中...",
        "config_saved": "設定を保存しました。",
        "session_configured": "Webセッションが設定・検証されました！",
        "lang_select": "言語を選択してください:",
        "lang_changed": "言語が{lang}に変更されました。",
        "lang_current": "現在の言語: {lang}",
        # Resto: fallback automatico a ingles via t()
    },
}
